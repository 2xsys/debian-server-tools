#!/bin/bash
#
# Run ntpdate daily and on reboot to correct the system clock.
#
# VERSION       :0.1.0
# DATE          :2015-12-24
# AUTHOR        :Viktor Sz√©pe <viktor@szepe.net>
# LICENSE       :The MIT License (MIT)
# URL           :https://github.com/szepeviktor/debian-server-tools
# BASH-VERSION  :4.2+
# LOCATION      :/usr/local/sbin/ntpdated-static
# CRON.D        :@reboot	root	/usr/local/sbin/ntpdated-static
# CRON.D        :@hourly	root	/usr/local/sbin/ntpdated-static

# Options can be set in /etc/default/ntpdate

Get_pool_ip() {
    {
        # IP addresses of {0..3}.de.pool.ntp.org
        cat <<EOF
5.9.29.107
5.9.49.12
5.9.65.75
5.9.80.113
5.9.118.105
5.9.122.148
5.45.97.110
5.83.190.253
5.100.133.221
31.25.153.77
37.120.173.240
46.4.24.238
46.4.54.78
46.4.58.140
46.101.216.211
46.163.88.228
46.163.88.237
46.163.88.246
46.165.194.70
62.75.202.83
62.75.236.38
62.75.254.179
62.116.130.3
62.116.162.126
78.46.53.8
78.46.76.100
78.46.93.106
78.46.107.140
78.46.189.152
78.47.138.42
78.47.148.174
78.47.226.8
78.47.249.19
78.111.224.11
79.133.48.121
81.7.16.52
81.88.24.155
81.169.196.230
81.169.209.209
82.100.248.10
84.200.12.135
85.25.197.197
85.25.210.112
85.31.190.200
85.93.7.12
85.114.130.211
85.214.59.199
85.214.193.52
85.214.217.110
85.214.239.213
85.236.36.4
87.106.90.51
91.237.88.67
109.75.177.149
109.75.223.1
109.239.48.152
129.70.132.32
129.70.132.33
129.70.132.36
129.70.132.37
129.250.35.250
129.250.35.251
130.255.72.135
131.188.3.221
131.234.137.23
131.234.137.24
134.106.187.58
136.243.102.134
144.76.4.122
144.76.14.132
144.76.38.73
144.76.44.69
144.76.95.77
144.76.96.7
144.76.115.197
144.76.117.245
144.76.172.53
144.76.202.253
144.76.223.148
148.251.6.51
148.251.84.200
148.251.90.84
148.251.127.15
148.251.154.36
176.9.1.148
176.9.1.211
176.9.40.142
176.9.41.109
176.9.92.196
176.9.100.86
176.9.102.215
176.9.253.75
176.9.253.76
178.23.121.164
178.23.121.165
178.63.9.110
178.63.102.198
178.63.135.195
178.162.194.82
188.68.50.58
188.138.0.101
188.174.253.163
192.162.168.12
194.97.156.5
212.18.3.18
212.18.3.19
213.61.224.35
213.95.21.43
213.136.86.203
213.198.55.2
213.209.109.45
217.13.65.177
217.79.179.106
217.79.181.50
EOF
    } | sort -R | head -n 4
}

if [ -r /etc/default/ntpdate ]; then
    source /etc/default/ntpdate
fi

/usr/sbin/ntpdate -s ${NTPOPTIONS} "$@" $(Get_pool_ip)

exit 0
